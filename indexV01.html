<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume AI Interview</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        input, button {
            margin: 10px;
            padding: 10px;
            font-size: 16px;
        }
        pre {
            white-space: pre-wrap;
            text-align: left;
            display: inline-block;
            max-width: 80%;
            margin-top: 20px;
            border: 1px solid #ddd;
            padding: 10px;
            background: #f9f9f9;
        }
    </style>
</head>
<body>
    <h1>Resume AI Interview Question Generator</h1>
    <input type="file" id="resumeFile" accept="application/pdf">
    <button onclick="processResume()">Upload & Generate Questions</button>

    <h2>Generated Questions</h2>
    <pre id="questions">Upload a resume to generate questions...</pre>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";
        const API_KEY = "AIzaSyAvS8XWVRS17MEZRdN_p2PeutI3IdZCqAg"; // Replace with your actual API key

        async function extractTextFromPDF(pdfFile) {
            const reader = new FileReader();
            return new Promise((resolve, reject) => {
                reader.onload = async function () {
                    try {
                        const pdfData = new Uint8Array(reader.result);
                        const pdf = await pdfjsLib.getDocument({ data: pdfData }).promise;
                        let text = "";

                        for (let i = 1; i <= pdf.numPages; i++) {
                            let page = await pdf.getPage(i);
                            let content = await page.getTextContent();
                            let pageText = content.items.map(item => item.str).join(" ");
                            text += pageText + "\n";
                        }

                        resolve(text);
                    } catch (error) {
                        reject("Error extracting text from PDF: " + error);
                    }
                };
                reader.onerror = () => reject("Error reading PDF file.");
                reader.readAsArrayBuffer(pdfFile);
            });
        }

        async function generateInterviewQuestions(resumeText) {
            const prompt = `Analyze this resume and generate only a list of interview questions categorized as:
            - Technical
            - Behavioral
            - Situational
            Do not include any explanations or extra text. 

            Resume Content:
            ${resumeText}`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-1.5-pro:generateContent?key=${API_KEY}`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status} ${response.statusText}`);
                }

                const result = await response.json();
                let questions = result.candidates?.[0]?.content?.parts?.[0]?.text || "No questions generated.";

                // Remove any AI-generated footer content if present
                questions = questions.replace(/(This response was generated.*)/gi, "").trim();

                return questions;
            } catch (error) {
                console.error("Error calling Gemini API:", error);
                return "Error generating questions. Check console for details.";
            }
        }

        async function processResume() {
            const fileInput = document.getElementById("resumeFile");
            if (!fileInput.files.length) {
                alert("Please upload a resume first.");
                return;
            }

            document.getElementById("questions").innerText = "Extracting text from resume...";

            try {
                const resumeText = await extractTextFromPDF(fileInput.files[0]);
                document.getElementById("questions").innerText = "Generating AI questions...";
                const questions = await generateInterviewQuestions(resumeText);
                document.getElementById("questions").innerText = questions;
            } catch (error) {
                console.error("Error processing resume:", error);
                document.getElementById("questions").innerText = "Error processing resume. Check console.";
            }
        }
    </script>
</body>
</html>
